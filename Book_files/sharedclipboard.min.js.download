var sharedClipboard=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(2);t.utils=o;var n=r(5);t.idbPromised=n;var i=r(1);t.ULS=i.ULS,t.TraceLevel=i.TraceLevel,t.LogCategory=i.LogCategory,t.NulLogger=i.NulLogger,t.ConsoleLogger=i.ConsoleLogger;var a=r(6);t.browserSupport=a;var s=r(7);t.perfWatch=s;var l=r(8);t.initEwaUtils=l.initEwaUtils,t.ewaUtils=l.ewaUtils;var c=r(9);t.initStopwatchFactory=c.initStopwatchFactory;var d=r(10);t.getNewGuid=d.getNewGuid},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(t.TraceLevel||(t.TraceLevel={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS"}(t.LogCategory||(t.LogCategory={})),t.ULS={getFromExternalLogger:function(e){var t=e;return{ULS:{trace:function(e,r,o){return t.traceTag(0,e,r,o)},traceTag:function(e,r,o,n){return t.traceTag(e,r,o,n)},debugTrace:function(e,r,o){return t.debugTraceTag(0,e,r,o)},debugTraceTag:function(e,r,o,n){return t.debugTraceTag(e,r,o,n)},assert:function(e,r,o){return t.assertTag(0,e,r,o)},assertTag:function(e,r,o,n){return t.assertTag(e,r,o,n)},shipAssert:function(e,r,o){return t.shipAssertTag(0,e,r,o)},shipAssertTag:function(e,r,o,n){return t.shipAssertTag(e,r,o,n)}}}}};var o=function(){function e(){}return e.prototype.shipAssertTag=function(e,t,r,o){console.assert(r,"shipAssertTag:",e,t,o)},e.prototype.assertTag=function(e,t,r,o){console.assert(r,"assertTag",e,t,o)},e.prototype.traceTag=function(e,t,r,o){console.log("traceTag",e,o,t,r)},e.prototype.debugTraceTag=function(e,t,r,o){console.log("debugTraceTag",e,o,t,r)},e}();t.ConsoleLogger=o;var n=function(){function e(){}return e.prototype.shipAssertTag=function(){},e.prototype.assertTag=function(){},e.prototype.traceTag=function(){},e.prototype.debugTraceTag=function(){},e}();t.NulLogger=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEachPromise=function(e,t,r){return e.reduce(function(e,o){return e.then(function(){return r&&r.stop?Promise.resolve(void 0):t(o,r)})},Promise.resolve(void 0))},t.defaultToJSONResultWhenStringifyFails="...",t.getStringifiedError=function(e){if(0===e)return"0";if(!e)return"";try{return JSON.stringify(function e(t,r){void 0===r&&(r=0);if(r<0||r>o)return t;if(null==t||"object"!=typeof t)return t;var n={};Object.getOwnPropertyNames(t).forEach(function(e){"stack"!==e&&e.toUpperCase()!==e&&(n[e]=t[e])});var i=Object.getPrototypeOf(t);i&&"object"==typeof i&&Object.keys(i).forEach(function(e){"stack"!==e&&e.toUpperCase()!==e&&(n[e]=t[e])});var a={};Object.keys(n).forEach(function(t){a[t]=e(n[t],r+1)});return a}(e))}catch(e){return t.defaultToJSONResultWhenStringifyFails}};var o=5;var n="_",i=new RegExp("\\W+","g");t.getPerfWatchMarkName=function(e){if(!e)return"";var t=e.trim().substring(0,200).trim().replace(i,n).substring(0,80);return t&&t.length>0&&t.substr(t.length-1,1)===n&&(t=t.substr(0,t.length-1)),t&&t.length>0&&t.substr(0,1)===n&&(t=t.substr(1)),t},t.retry=function(e,t){if(!e)return Promise.reject(new Error("utils.retry: action can't be null or undefined"));if(t<1)return Promise.reject(new Error("utils.retry: attempts expected to be greater than 0 but got "+t));for(var r=Promise.reject(void 0),o=function(t){r=r.catch(function(r){return e(t,r)})},n=1;n<=t;n+=1)o(n);return r},t.chainFallbackPromises=function(e,t){if(!e||0===e.length)return Promise.resolve();for(var r=t(e[0]),o=function(o){var n=e[o];r=r.catch(function(){return t(n)})},n=1;n<e.length;n+=1)o(n);return r},t.getQueryParameterByName=function(e,t){var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""},t.calcHashCode=function(e){if(!e)return 0;for(var t=5381,r=t,o=e.length,n=0;n<o&&(t=4294967295&((t<<5)+t^e.charCodeAt(n)),n!==o-1);n+=2)r=4294967295&((r<<5)+r^e.charCodeAt(n+1));var i=t+35685*r+(23896*r<<16)&4294967295;return i<0&&(i+=4294967296),i},t.getCharIndexInTextFromPoint=function(e,t){var r=-1,o=null;if(void 0!==document.caretPositionFromPoint)null!==(n=document.caretPositionFromPoint(e,t))&&(r=n.offset,o=null!=n.offsetNode&&null!=n.offsetNode.parentElement&&"SPAN"===n.offsetNode.parentElement.nodeName?n.offsetNode.parentElement:n.offsetNode);else if(void 0!==document.caretRangeFromPoint){null!==(n=document.caretRangeFromPoint(e,t))&&(r=n.startOffset,o=null!=n.startContainer&&null!=n.startContainer.parentElement&&"SPAN"===n.startContainer.parentElement.nodeName?n.startContainer.parentElement:n.startContainer)}else try{var n;o=document.elementFromPoint(e,t),(n=document.body.createTextRange()).moveToPoint(e,t);var i=document.body.createTextRange();i.moveToElementText(o),i.setEndPoint("EndToStart",n),r=i.text.length}catch(e){return r}for(;null!=o;)null!=(o=o.previousSibling)&&null!=o.textContent&&(r+=o.textContent.length);return r}},function(e,t,r){"use strict";var o={};r.r(o),r.d(o,"sharedClipboardSettingsVariableName",function(){return N}),r.d(o,"defaultPromiseTimeoutInMinutes",function(){return V}),r.d(o,"getSharedClipboardSettings",function(){return k}),r.d(o,"initializeSharedClipboardSettingsFromWindow",function(){return B}),r.d(o,"initializeSharedClipboardSettings",function(){return K}),r.d(o,"createEmptySharedClipboardSettings",function(){return q});var n,i=r(0);function a(){return n}function s(e){if(!e)throw new Error("The 'logger' argument is missing");n=i.ULS.getFromExternalLogger(e)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function c(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var d,u,g,p,f,m="";!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.SystemClipboardAndIndexedDB=1]="SystemClipboardAndIndexedDB",e[e.IndexedDB=2]="IndexedDB",e[e.FullAccessClipboardAndInMemory=3]="FullAccessClipboardAndInMemory",e[e.InMemory=4]="InMemory",e[e.LocalStorage=5]="LocalStorage",e[e.SystemClipboardAndLocalStorage=6]="SystemClipboardAndLocalStorage",e[e.SystemClipboardAndInMemory=7]="SystemClipboardAndInMemory"}(d||(d={})),function(e){e[e.UnsupportedClipboardStrategyType=0]="UnsupportedClipboardStrategyType",e[e.UnsupportedClipboardStorageType=1]="UnsupportedClipboardStorageType",e[e.ClipboardIsInaccessible=2]="ClipboardIsInaccessible",e[e.SetClipboardItems=3]="SetClipboardItems",e[e.IndexedDBSetClipboardItems=4]="IndexedDBSetClipboardItems",e[e.GetClipboardItems=5]="GetClipboardItems",e[e.IndexedDBGetClipboardItems=6]="IndexedDBGetClipboardItems",e[e.NoGetOperationResultMessage=7]="NoGetOperationResultMessage",e[e.NoSetOperationResultMessage=8]="NoSetOperationResultMessage",e[e.ClearClipboardItems=9]="ClearClipboardItems",e[e.MissingBrowserExtensionCapability=10]="MissingBrowserExtensionCapability",e[e.NoBrowserExtensionsInConfiguration=11]="NoBrowserExtensionsInConfiguration",e[e.NoAvailableBrowserExtensions=12]="NoAvailableBrowserExtensions",e[e.UnavailableBrowserExtension=13]="UnavailableBrowserExtension",e[e.SelectClipboardStrategy=14]="SelectClipboardStrategy",e[e.IndexedDBProviderNotSupported=15]="IndexedDBProviderNotSupported",e[e.IndexedDBCacheInitialization=16]="IndexedDBCacheInitialization",e[e.IndexedDBGetCache=17]="IndexedDBGetCache",e[e.IndexedDBDeleteDb=18]="IndexedDBDeleteDb",e[e.IndexedDBSetItem=19]="IndexedDBSetItem",e[e.IndexedDBGetItem=20]="IndexedDBGetItem",e[e.IndexedDBGetAllKeys=21]="IndexedDBGetAllKeys",e[e.IndexedDBGetAllItems=22]="IndexedDBGetAllItems",e[e.IndexedDBRemoveItem=23]="IndexedDBRemoveItem",e[e.IndexedDBRemoveAllItems=24]="IndexedDBRemoveAllItems",e[e.IndexedDBClearAll=25]="IndexedDBClearAll",e[e.UnsupportedOperationCode=26]="UnsupportedOperationCode",e[e.RejectingPendingPastePromiseDueToNewPasteOperation=27]="RejectingPendingPastePromiseDueToNewPasteOperation",e[e.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation=28]="RejectingPendingCutCopyPromiseDueToNewCutCopyOperation",e[e.RejectingBlockedSyncCutCopyPromise=29]="RejectingBlockedSyncCutCopyPromise",e[e.IndexedDBCacheInitializationTimeout=30]="IndexedDBCacheInitializationTimeout",e[e.IndexedDBSetTimeout=31]="IndexedDBSetTimeout",e[e.IndexedDBGetTimeout=32]="IndexedDBGetTimeout",e[e.ClipboardStrategyNotInitialized=33]="ClipboardStrategyNotInitialized",e[e.UnexpectedClipboardTextHtmlContentLength=34]="UnexpectedClipboardTextHtmlContentLength",e[e.InvalidClipboardStrategyType=35]="InvalidClipboardStrategyType",e[e.CreateWindowRPCServer=36]="CreateWindowRPCServer",e[e.RefreshMetadata=37]="RefreshMetadata",e[e.DeserializedMetadata=38]="DeserializedMetadata",e[e.SerializedMetadata=39]="SerializedMetadata",e[e.LocalStorageInitilizationInaccessible=40]="LocalStorageInitilizationInaccessible",e[e.LocalStorageInitilizationNoKey=41]="LocalStorageInitilizationNoKey",e[e.IframeProxyGeneralError=42]="IframeProxyGeneralError",e[e.IframeProxyEmptyResultMessage=43]="IframeProxyEmptyResultMessage"}(u||(u={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.CopyFlowHandlerNotFound=1]="CopyFlowHandlerNotFound",e[e.FetchCopyFlowHandlerFailed=2]="FetchCopyFlowHandlerFailed",e[e.FetchSourceItemFailed=3]="FetchSourceItemFailed",e[e.BeforeSerializeFailed=4]="BeforeSerializeFailed",e[e.SerializeFailed=5]="SerializeFailed",e[e.SerializeResultNotValid=6]="SerializeResultNotValid",e[e.AsyncSerializeFailed=7]="AsyncSerializeFailed",e[e.SaveToTheClipboardFailed=8]="SaveToTheClipboardFailed",e[e.InspectClipboardFailed=9]="InspectClipboardFailed",e[e.ClipboardIsInaccessible=10]="ClipboardIsInaccessible",e[e.SuccessiveCutCopyOverridingPendingCutCopy=11]="SuccessiveCutCopyOverridingPendingCutCopy",e[e.BlockedSynchronousCutCopy=12]="BlockedSynchronousCutCopy",e[e.CopyOperationCancelled=13]="CopyOperationCancelled",e[e.UnknownCopyErrorType=14]="UnknownCopyErrorType"}(g||(g={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.PasteFlowHandlerNotFound=1]="PasteFlowHandlerNotFound",e[e.FetchPasteFlowHandlerFailed=2]="FetchPasteFlowHandlerFailed",e[e.FailedToReadFromClipboard=3]="FailedToReadFromClipboard",e[e.InspectClipboardFailed=4]="InspectClipboardFailed",e[e.ReadFromClipboardReturnNullOrUndefined=5]="ReadFromClipboardReturnNullOrUndefined",e[e.ClipboardIsEmpty=6]="ClipboardIsEmpty",e[e.DeserializeOperationFailed=7]="DeserializeOperationFailed",e[e.ClipboardIsInaccessible=8]="ClipboardIsInaccessible",e[e.SuccessivePasteOverridingPendingPaste=9]="SuccessivePasteOverridingPendingPaste",e[e.FileReaderResultIsEmpty=10]="FileReaderResultIsEmpty",e[e.FileReaderFailed=11]="FileReaderFailed",e[e.UnknownPasteError=12]="UnknownPasteError",e[e.DeferredPasteRejectedBecauseOtherCopyCompleted=13]="DeferredPasteRejectedBecauseOtherCopyCompleted",e[e.DeferredPasteRejectedBecauseOtherCopyStarted=14]="DeferredPasteRejectedBecauseOtherCopyStarted",e[e.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext=15]="DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext"}(p||(p={})),function(e){e[e.FailedToClearClipboard=0]="FailedToClearClipboard"}(f||(f={}));var h=function(e){function t(r,o,n){var s=this,l=t.augmentParameterValue(r);if((s=e.call(this,l)||this).name=t.augmentParameterValue(o),s.errorName=s.name,s.name?a().ULS.traceTag(596456211,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Error '"+s.name+"': "+l):a().ULS.traceTag(596456212,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Error message: "+l),n){s.innerError=n;var c=s.innerError.message;c||(c=s.innerError.name);var d=t.augmentParameterValue(c);d.length>0&&a().ULS.traceTag(596456213,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Inner error message: "+d)}return s.stack||(s.stack=(new Error).stack),s}return c(t,e),t.augmentParameterValue=function(e){return e&&"string"==typeof e?e.trim():m},t}(Error),S=function(e){function t(r,o,n){var i=this,a=h.augmentParameterValue(o),s=t.getDefaultMessage(a),l=h.augmentParameterValue(r);return 0===l.length&&(l=s),(i=e.call(this,l,"MissingArgumentError",n)||this).name=a,i}return c(t,e),t.getDefaultMessage=function(e){var t="Missing argument";return e.length>0&&(t="Missing argument: '"+e+"'"),t},t}(h),w=function(e){function t(r,o,n,i){var a=this,s=h.augmentParameterValue(o),l=n;l||(l=m);var c=t.getDefaultMessage(s,l),d=h.augmentParameterValue(r);return 0===r.length&&(d=c),(a=e.call(this,d,"InvalidArgumentError",i)||this).name=s,a.value=l,a}return c(t,e),t.getDefaultMessage=function(e,t){return e.length>0?"Invalid '"+e+"' argument: '"+t+"'":"Invalid argument"},t}(h),C=function(e){function t(t,r){return e.call(this,t,"InvalidOperationError",r)||this}return c(t,e),t}(h);(function(e){function t(t,r){return e.call(this,t,"UnsupportedError",r)||this}c(t,e)})(h),function(e){function t(t,r,o,n,i){return e.call(this,t+". Data version: "+r+", Infra version: "+o+", blockMismatchDataVersion: "+n,"MismatchVersionError",i)||this}c(t,e)}(h),function(e){function t(t,r,o,n){return e.call(this,t+". Duration in clipboard (ms) : "+r+", TTL (ms): "+o,"TTLClipboardDataError",n)||this}c(t,e)}(h),function(e){function t(t,r,o,n){return e.call(this,t+". Data User Hash : "+r+", infra User Hash: "+o,"UserHashMismatchError",n)||this}c(t,e)}(h),function(e){function t(t,r){return e.call(this,t,"UnexpectedError",r)||this}c(t,e)}(h);function v(e,t){return function(e,t){return void 0!==e&&"number"==typeof e&&e>=0&&e<Object.keys(t).length/2}(e,t)?t[e]:m}var b=function(e){function t(t,r,o,n,i){var a=e.call(this,r||"reason="+t,o,n)||this;return a.reason=t,i&&(a.errorName=i),a}return c(t,e),t}(h),y=(function(e){function t(t,r,o){return e.call(this,t,r,"CopyError",o,v(t,g))||this}c(t,e)}(b),function(e){function t(t,r,o){return e.call(this,t,r,"PasteError",o,v(t,p))||this}c(t,e)}(b),function(e){function t(t,r,o){return e.call(this,t,r,"CancelError",o,v(t,f))||this}c(t,e)}(b),function(e){function t(t,r,o){return e.call(this,t,r,"ClipboardPlatformError",o,v(t,u))||this}return c(t,e),t}(b));!function(e){function t(t,r,o){return e.call(this,t,r,"SharedClipboardError",o,v(t,u))||this}c(t,e)}(b);new RegExp("(\\bTrident/| MSIE )"),new RegExp("\\bEdge/(\\d+\\.\\d+)\\b");var E={postMessage:function(e,t,r,o){e.postMessage(t,r,o)}},T="text/plain";var L,_,I,P,A=(L={items:{}},{getData:function(){return L},getItem:function(e){},setItem:function(e,t){throw new C("Cannot set an item with clipboard data format '"+e+"' in an immutable empty clipboard (content is "+(t&&t.length>0?"not ":m)+"empty)")},get:function(){return R(void 0)}});function M(){return A}function x(e){return e&&e.items?Object.keys(e.items).length:0}function W(e){return x(e&&e.getData())}function D(e){void 0===e&&(e=void 0);var t=e;return t||(t={items:{}}),{getItem:function(e){return O(t,e)},setItem:function(e,r){!function(e,t,r){if(!e)throw new S(m,"clipboardItemsData");if(!e.items)throw new w(m,"clipboardItemsData.items");e.items[t]=r}(t,e,r)},getData:function(){return t},get:function(){return R(t)}}}function O(e,t){if(!e)throw new S(m,"clipboardItemsData");if(!e.items)throw new w(m,"clipboardItemsData.items");return e.items[t]}function R(e){var t=[];if(0===x(e))return t;for(var r in e.items){var o=O(e,r);o||(o=m);var n={clipboardDataFormat:r,data:o};t.push(n)}return t}!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.IndexedDB=1]="IndexedDB",e[e.InMemory=2]="InMemory",e[e.LocalStorage=3]="LocalStorage"}(_||(_={})),function(e){e[e.None=0]="None",e[e.Cut=1]="Cut",e[e.Copy=2]="Copy",e[e.Paste=4]="Paste",e[e.Values=16]="Values",e[e.Formatting=32]="Formatting",e[e.Formulas=64]="Formulas",e[e.DragDropCells=128]="DragDropCells",e[e.DragDropNoErrMsg=256]="DragDropNoErrMsg",e[e.Transpose=512]="Transpose",e[e.PasteValues=20]="PasteValues",e[e.PasteFormatting=36]="PasteFormatting",e[e.PasteFormulas=68]="PasteFormulas",e[e.PasteTranspose=516]="PasteTranspose"}(I||(I={})),function(e){e[e.NoError=0]="NoError",e[e.LocalStorageInaccessible=1]="LocalStorageInaccessible"}(P||(P={}));var U="SessionId",F="-",N="sharedClipboardSettings",J=q(),H=!1,j=1,z=3600,V=2;function k(){if(!H)throw new C("First initialize the settings via initializeSharedClipboardSettingsFromWindow() or initializeSharedClipboardSettings()");return J}function B(){H=!1,function(){if(!(window&&N in window))return J=q(),void(H=!0);var e=window[N];if(!e||"object"!=typeof e)return J=q(),void(H=!0);G(e)}()}function K(e){H=!1,G(e)}function G(e){if(!e)throw new S(m,"sharedClipboardSettingsCandidate");var t=q();if("number"!=typeof e.sharedClipboardSchemaVersion||isNaN(e.sharedClipboardSchemaVersion)||(t.sharedClipboardSchemaVersion=e.sharedClipboardSchemaVersion),"number"!=typeof e.sharedClipboardExpirationInMinutes||isNaN(e.sharedClipboardExpirationInMinutes)||(t.sharedClipboardExpirationInMinutes=e.sharedClipboardExpirationInMinutes),"number"!=typeof e.clipboardPromiseTimeoutInMinutes||isNaN(e.clipboardPromiseTimeoutInMinutes)||(t.clipboardPromiseTimeoutInMinutes=e.clipboardPromiseTimeoutInMinutes),"string"==typeof e.remoteLoggerPath&&e.remoteLoggerPath&&e.remoteLoggerPath.trim()&&(t.remoteLoggerPath=e.remoteLoggerPath),"number"!=typeof e.whitelistOriginComponents||1!==e.whitelistOriginComponents)return J=t,void(H=!0);if("string"!=typeof e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp.trim())return a().ULS.traceTag(596124181,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApp should be a non empty string"),J=t,void(H=!0);t.sharedClipboardHostingApp=e.sharedClipboardHostingApp.trim();var r=t.sharedClipboardHostingApp,o=r.indexOf(F);o>=0&&(r=r.substr(o+1));try{t.sharedClipboardHostingApps=e.sharedClipboardHostingApps?JSON.parse(e.sharedClipboardHostingApps):void 0}catch(e){}if(!t.sharedClipboardHostingApps||!Array.isArray(t.sharedClipboardHostingApps)||0===t.sharedClipboardHostingApps.length||t.sharedClipboardHostingApps.some(function(e){return!e||!e.trim()}))return a().ULS.traceTag(596124182,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps should be a JSON string representing an array with at list one app"),t.sharedClipboardHostingApp=m,t.sharedClipboardHostingApps=[],J=t,void(H=!0);try{t.sharedClipboardHostingEnvironments=e.sharedClipboardHostingEnvironments?JSON.parse(e.sharedClipboardHostingEnvironments):void 0}catch(e){}if(!t.sharedClipboardHostingEnvironments||!Array.isArray(t.sharedClipboardHostingEnvironments)||0===t.sharedClipboardHostingEnvironments.length||t.sharedClipboardHostingEnvironments.some(function(e){return!e||!e.trim()}))return a().ULS.traceTag(596124183,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments should be a JSON string representing an array with at list one environment"),t.sharedClipboardHostingApp=m,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],J=t,void(H=!0);if(t.sharedClipboardHostingApps.indexOf(t.sharedClipboardHostingApp)<0){if(t.sharedClipboardHostingApp===r)return a().ULS.traceTag(596124184,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '"+t.sharedClipboardHostingApp+"' should be listed in sharedClipboardHostingApps"),t.sharedClipboardHostingApp=m,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],J=t,void(H=!0);if(t.sharedClipboardHostingApps.indexOf(r)<0)return a().ULS.traceTag(596124185,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '"+t.sharedClipboardHostingApp+"' or '"+r+"' should be listed in sharedClipboardHostingApps"),t.sharedClipboardHostingApp=m,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],J=t,void(H=!0)}t.whitelistOriginComponents=!0,J=t,H=!0}function q(){return{whitelistOriginComponents:!1,sharedClipboardHostingApp:m,sharedClipboardHostingApps:[],sharedClipboardHostingEnvironments:[],sharedClipboardSchemaVersion:j,sharedClipboardExpirationInMinutes:z,clipboardPromiseTimeoutInMinutes:V,remoteLoggerPath:m}}var Q,X,$="://",Y="http",Z="https",ee=".",te="/",re=":",oe=new RegExp("^\\d+$"),ne=!1;function ie(e){if(!e)throw new S(m,"origin");var t=e.trim().toLowerCase(),r=m,o=t.split($,3);if(!o||0===o.length||!o[0]||o[0]!==Y&&o[0]!==Z)throw new w("Missing protocol","origin",e);if(1===o.length)throw new w("Missing domain","origin",e);if(o.length>2)throw new w("'"+$+"' should appear once","origin",e);var n=o[1];if(!n)throw new w("Missing domain","origin",e);if(r=o[0]+$,!(o=(n=n.trim()).trim().split(te,3))||0===o.length||!o[0]||!o[0].trim())throw new w("Missing domain","origin",e);if(o.length>2)throw new w("The last part of the origin should be the domain","origin",e);if(2===o.length&&o[1])throw new w("The last part of the origin should be the domain","origin",e);if(!(o=n.split(re,3))||0===o.length||!o[0]||!o[0].trim())throw new w("Missing domain","origin",e);if(o.length>2||2===o.length&&(!o[1]||!o[1].trim()))throw new w("The last part of the origin should be the domain and an optional port number","origin",e);if(r+=n=o[0].trim(),2===o.length){var s=o[1].trim(),l=oe.exec(s);if(!l||1!==l.length)throw new w("Invalid port number","origin",e);var c=Number(s);if(isNaN(c))throw new w("Invalid port number","origin",e);r+=re+s}return a().ULS.traceTag(596452423,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"getValidatedOrigin: origin = '"+e+"'; validated origin = '"+r+"'"),r}function ae(e){de();var t,r=ie(e),o=ie((t=m,window&&window.location&&window.location.origin?(t=window.location.origin)||(t=m):(a().ULS.traceTag(595932950,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"windowLocation.getWindowLocation: is window exist: "+!!window+". is window.location exist: "+(window&&!!window.location)+". is window.location.origin exist "+(window&&window.location&&!!window.location.origin)+". is window.location.protocol exist "+(window&&window.location&&!!window.location.protocol)+". is window.location.hostname exist "+(window&&window.location&&!!window.location.hostname)+". is window.location.port exist "+(window&&window.location&&!!window.location.port)),window&&window.location&&window.location.protocol&&window.location.hostname&&(t=window.location.protocol+"//"+window.location.hostname,window.location.origin=t)),{origin:t}).origin);if(r===o)return r;if(!k().whitelistOriginComponents)throw new C("validateOriginForReceivedMessage: Caller origin '"+e+"' doesn't match the current window's origin '"+o+"'");var n=se(r),s=se(o);if(n.protocol!==s.protocol)throw new C("validateRemoteWindowOrigin: Caller origin's protocol '"+n.protocol+"' doesn't match the current window origin's protocol '"+s.protocol+"'");if(n.environment!==s.environment)throw new C("validateRemoteWindowOrigin: Caller origin's environment '"+n.environment+"' doesn't match the current window origin's environment '"+s.environment+"'");return r}function se(e){de();var t=e.split($,2),r=t[0],o=le(t[1]),n={protocol:r};if(n.environment=ce(e,o,X),o.length<=n.environment.length+1)throw new w("Missing app component","origin",e);if(o.charAt(n.environment.length)!==ee)throw new w("Missing a domain separator after the environment component","origin",e);var i=o.substr(n.environment.length+ee.length);if(n.app=ce(e,i,Q),n.app.length<i.length&&i.charAt(n.app.length)!==F)throw new w("When the Office Online app name is not the domain prefix, '"+F+"' should precede it","origin",e);return n}function le(e){if(!e)throw new S(m,"stringToReverse");for(var t=e.length,r=m,o=t-1;o>=0;o-=1)r+=e.charAt(o);return r}function ce(e,t,r){if(!t)throw new S(m,"reversedValidatedHostname");if(!r)throw new S(m,"reversedStringsToLengthMap");var o=t.length,n=Object.keys(r).filter(function(e){var n=r[e];return n<=o&&t.substr(0,n)===e});if(n&&n.length>0)return le(n[0]);throw new w("Invalid origin","validatedOrigin",e)}function de(){if(!ne){var e=k();e.whitelistOriginComponents&&(Q=ue(e.sharedClipboardHostingApps),X=ue(e.sharedClipboardHostingEnvironments),ne=!0)}}function ue(e){var t={};return e&&Array.isArray(e)&&0!==e.length?(e.forEach(function(e){t[le(e)]=e.length}),t):t}function ge(){return fe()}function pe(e){if(!e)throw new S(m,"id");var t=e.trim().toLowerCase();if(0===t.length)throw new w(m,"id");return t}function fe(){return(Math.random()+1).toString(36).substring(7)}var me=function(){function e(){}return e.localStorageData="localStorage/data",e.indexedDBData="indexedDB/data",e.localStorageMetadata="localStorage/metadata",e.initIframe="initIframe",e}();function he(e){return"get"===e||"set"===e||"init"===e}var Se=function(e){if(!e)throw new S(m,"clipboardOperationMessage");if(!e.id||0===e.id.trim().length)throw new S(m,"id");if(!e.operationCode)throw new S(m,"operationCode");if(!e.destination)throw new S(m,"destination");if(!he(e.operationCode))throw new w(m,"operationCode",e.operationCode);if("set"!==e.operationCode&&e.clipboardItemsData)throw new w("'"+e.operationCode+"' expects no clipboard items","clipboardItemsData")};function we(e,t,r,o,n){var i={id:e,operationCode:t,failed:r,error:o,clipboardItemsData:n};return Ce(i),i}var Ce=function(e){if(!e)throw new S(m,"clipboardOperationResultMessage");if(!e.id||0===e.id.trim().length)throw new S(m,"id");if(!e.operationCode)throw new S(m,"operationCode");if("getresult"!==e.operationCode&&"setresult"!==e.operationCode&&"initresult"!==e.operationCode&&"unknownresult"!==e.operationCode&&"getMetadata_longPollingresult"!==e.operationCode)throw new w(m,"operationCode",e.operationCode);if(e.failed){if(!e.error)throw new w("A failed '"+e.operationCode+"' operation expects a non-empty error argument","error");if(e.clipboardItemsData)throw new w("A failed '"+e.operationCode+"' operation does not expect a clipboardItemsData argument","clipboardItemsData")}else{if(e.error)throw new w("'"+e.operationCode+"' expects an empty error argument","error");if("unknownresult"===e.operationCode)throw new w("'"+e.operationCode+"' can only be used with a failure message","operationCode")}if("getresult"===e.operationCode||"getMetadata_longPollingresult"===e.operationCode){if(!e.failed&&!e.clipboardItemsData)throw new w("'"+e.operationCode+"' expects a clipboardItems argument","clipboardItemsData")}else if(e.clipboardItemsData)throw new w("'"+e.operationCode+"' expects no clipboardItemsData argument","clipboardItemsData")};function ve(e){if(!e||0===e.trim().length)throw new w(m,"className",e);return function(){var t=!1;function r(t){return e+":"+t+": already disposed"}return{dispose:function(){t=!0},logIfDisposed:function(e){return t&&a().ULS.traceTag(596456217,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,r(e)),t},throwIfDisposed:function(e){if(t)throw new C(r(e))}}}()}var be=function(){function e(e,t,r){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.clipboardDataProcessor=r,this.disposableImplementationExtension=ve(""+e)}return e.prototype.initialize=function(e){var t=this;return e.then(function(e){return t.clipboardStorage=e,a().ULS.traceTag(596453007,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Clipboard strategy type '"+t.clipboardStrategyType+"' was initialized."),Promise.resolve(t)},function(e){return a().ULS.traceTag(596453008,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Failed to initialize clipboard strategy type '"+t.clipboardStrategyType+"'. Error: "+i.utils.getStringifiedError(e)),Promise.reject(e)})},e.prototype.set=function(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.clipboardStorage){return a().ULS.shipAssertTag(596121485,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.set: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized))}return this.clipboardDataProcessor&&this.clipboardDataProcessor.preSetProcess(e),this.clipboardStorage.set(e,t)}catch(e){return Promise.reject(new y(u.SetClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").set",e))}},e.prototype.get=function(e){var t=this;try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.clipboardStorage){return a().ULS.shipAssertTag(596121486,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.get: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized))}return this.clipboardStorage.get(e).then(function(e){return t.clipboardDataProcessor&&t.clipboardDataProcessor.postGetProcess(e),Promise.resolve(e)})}catch(e){return Promise.reject(new y(u.GetClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").get",e))}},e.prototype.onSystemClipboardChangedExternally=function(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.clipboardStorage?this.clipboardCapabilities.systemClipboard?Promise.resolve():this.clipboardStorage.set(M(),e):(a().ULS.shipAssertTag(595882508,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized)))}catch(e){return Promise.reject(new y(u.ClearClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").onSystemClipboardChangedExternally",e))}},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.clipboardStorage&&this.clipboardStorage.dispose(),this.disposableImplementationExtension.dispose())},e}(),ye=!!window.performance&&!!window.performance.now&&!!window.performance.timing;function Ee(e){var t=e;return t&&0!==t.trim().length||(t=ge()),new Ie(t)}function Te(){return ye?window.performance.now():Date.now()}function Le(e){return ye?new Date(e+window.performance.timing.navigationStart):new Date(e)}function _e(e,t,r){if(!r)throw new S(m,"creationTimestamp");return(e?"Fulfilled":"Still unfulfilled")+" after "+(e?t?t-r:"?":Te()-r)+"ms"}var Ie=function(){function e(t){var r=this;this.isFulfilled=!1,this.fulfillmentTimestamp=void 0,this.rejected=!1,this.id=pe(t),e.sequenceId+=1,this.sequenceId=e.sequenceId,this.creationTimestamp=Te(),a().ULS.traceTag(596456225,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: creating deferred promise #"+this.sequenceId+" with id '"+this.id+"' on "+Le(this.creationTimestamp)),this.promise=new Promise(function(e,t){a().ULS.traceTag(596456226,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: registering callback for promise #"+r.sequenceId+" with id '"+r.id+"' on "+Le(Te())),r.internalResolve=e,r.internalReject=t})}return e.prototype.fulfilled=function(){return this.isFulfilled},e.prototype.resolve=function(e){this.markAsFulfilled("resolve"),this.internalResolve?this.internalResolve(e):a().ULS.traceTag(596456257,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise - resolve: the resolve for deferred promise #"+this.sequenceId+" with id '"+this.id+"' is not tracked with a callback")},e.prototype.reject=function(e){this.markAsFulfilled("reject"),this.internalReject?this.internalReject(e):a().ULS.traceTag(596456260,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise - reject: the reject for deferred promise #"+this.sequenceId+" with id '"+this.id+"' is not tracked with a callback")},e.prototype.markAsFulfilled=function(e){this.fulfillmentCheck(e)||(this.isFulfilled=!0,this.rejected="resolve"!==e,this.fulfillmentTimestamp=Te(),a().ULS.traceTag(596456261,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: marking promise #"+this.sequenceId+" with id '"+this.id+"' as fulfilled ("+(this.rejected?"rejected":"resolved")+"). "+_e(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)))},e.prototype.fulfillmentCheck=function(e){return a().ULS.traceTag(596456258,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: asked to "+e+" deferred promise #"+this.sequenceId+" with id '"+this.id+"'"),this.isFulfilled&&a().ULS.traceTag(596456259,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise: cannot "+e+" deferred promise #"+this.sequenceId+" with id '"+this.id+"' since it was "+(this.rejected?"rejected":"resolved")+" already on "+Le(this.fulfillmentTimestamp)+". "+_e(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)),this.isFulfilled},e.sequenceId=0,e}();!function(){function e(){this.deferredResultMessagePromiseCache={}}e.prototype.getDeferredPromise=function(e){var t=pe(e);return this.deferredResultMessagePromiseCache[t]},e.prototype.getPromise=function(e){var t=this.getDeferredPromise(e);if(t)return a().ULS.traceTag(596456218,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: found a deferred promise with id '"+e+"'."),t.promise;a().ULS.traceTag(596456219,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: there is no deferred promise with id '"+e+"'.")},e.prototype.addNewPromise=function(e){var t=Ee(e);if(this.getDeferredPromise(t.id))throw new w("A deferred promise already exists in the cache for the specified id","id",t.id);var r=pe(t.id);return this.deferredResultMessagePromiseCache[r]=t,a().ULS.traceTag(596456220,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: added a new deferred promise with id '"+t.id+"'."),t},e.prototype.getLength=function(){var e=0;for(var t in this.deferredResultMessagePromiseCache)e+=1;return e},e.prototype.delete=function(e){if(this.getDeferredPromise(e)){var t=pe(e);delete this.deferredResultMessagePromiseCache[t],a().ULS.traceTag(596456222,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: deleted id '"+e+"'.")}else a().ULS.traceTag(596456221,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: no need to delete an item with id '"+e+"' since this id is not associated with an existing deferred promise.")},e.prototype.clear=function(){if(a().ULS.traceTag(596456223,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: clearing "+this.getLength()+" items from the cache"),this.deferredResultMessagePromiseCache)for(var e in this.deferredResultMessagePromiseCache){var t=this.deferredResultMessagePromiseCache[e];if(t)try{t.reject()}catch(t){a().ULS.traceTag(596456224,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise cache: clear failed to reject promise id '"+e+"' with this exception: "+t.message+". Ignoring.")}}this.deferredResultMessagePromiseCache={}}}();function Pe(e){if(!e)throw new S(m,"validator");return{deserialize:function(t){return function(e,t){if(!e)throw new S(m,"incomingMessage");if(!t)throw new S(m,"validator");if(0===e.length)throw new w("An empty message is invalid","incomingMessage");var r,o=e.trim();if(0===o.length)throw new w("A message cannot contain only spaces","incomingMessage");try{r=JSON.parse(o)}catch(t){throw new w("Deserialization failed","incomingMessage","Contains "+e.length.toString()+" characters",t)}if(!r)throw new w("Deserialization returned nothing","incomingMessage");return t(r),r}(t,e)}}}function Ae(e){if(!e)throw new S(m,"validator");return{serialize:function(t){return function(e,t){if(!e)throw new S(m,"outgoingMessage");if(!t)throw new S(m,"validator");return t(e),function(e){var t;try{t=JSON.stringify(e)}catch(t){throw new w("Serialization failed","outgoingMessage",Object.keys(e).length+" properties",t)}return a().ULS.traceTag(596452375,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"The length of the serialized message is "+t.length),t}(e)}(t,e)}}}var Me="initmessageid",xe="CreatorOrigin";var We=function(){function e(e,t,r,o){this.serializer=e,this.deserializer=t,this.remoteWindow=r,this.remoteWindow=r,this._disposableImplementationExtension=ve(o)}return Object.defineProperty(e.prototype,"disposableImplementationExtension",{get:function(){return this._disposableImplementationExtension},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;this.disposableImplementationExtension.logIfDisposed("dispose")||(!function(e){if(e&&Array.isArray(e)&&0!==e.length){var t=0,r=void 0;if(e.forEach(function(e){if(t+=1,e)try{e()}catch(e){a().ULS.traceTag(596456216,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: callback action #"+t+" threw an exception: "+e.message),r||(r=new C(e.message,e))}else a().ULS.traceTag(596456215,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: callback action #"+t+" is empty")}),r)throw r}else a().ULS.traceTag(596456214,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: no actions to execute")}([function(){e.sender&&e.sender.dispose()},function(){e.receiver&&e.receiver.dispose()}]),this.disposableImplementationExtension.dispose())},e.prototype.postMessage=function(e){if(this.disposableImplementationExtension.throwIfDisposed("postMessage"),!e)throw new S(m,"outgoingMessage");if(!this.sender){var t="WindowRPCBase::postMessage - this.sender should be defined";throw a().ULS.shipAssertTag(596121484,i.LogCategory.msoulscat_ES_EWAJS,!1,t),new C(t)}this.sender.postMessage(e)},e}();function De(){return Oe}var Oe={addEventListener:function(e,t){return window.addEventListener(e,t)},removeEventListener:function(e,t){return window.removeEventListener(e,t)}};var Re="message",Ue=function(){function e(e,t,r){var o=this;if(this.deserializer=e,this.handler=t,this.windowMessageHandler=function(e){return o.onMessageReceived(e)},!e)throw new S(m,"deserializer");if(!t)throw new S(m,"handler");if(!r)throw new S(m,"windowRPC");this.disposableImplementationExtension=ve("WindowRPCReceiverInternal"),this.remoteWindow=r.remoteWindow,De().addEventListener(Re,this.windowMessageHandler)}return e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||(De().removeEventListener(Re,this.windowMessageHandler),this.disposableImplementationExtension.dispose())},e.prototype.shouldFilterMessageEvent=function(e){try{if(!e.origin||!e.source)return a().ULS.traceTag(596452370,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Window RPC Receiver: ignoring messages from unspecified window sources."),!0;if(e.source===window)return a().ULS.traceTag(596452371,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from this window to itself."),!0;if(this.remoteWindow.window&&e.source!==this.remoteWindow.window)return a().ULS.traceTag(596452372,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows other than the assigned remote window."),!0;if(e.origin.toLowerCase()!==this.remoteWindow.windowOrigin)return a().ULS.traceTag(596452373,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows with an origin that differs from remote window origin."),!0}catch(e){return!0}return!1},e.prototype.onMessageReceived=function(e){if(!this.shouldFilterMessageEvent(e)){var t=void 0;try{t=this.deserializer.deserialize(e.data)}catch(e){a().ULS.traceTag(596452374,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to deserialize incoming message. "+i.utils.getStringifiedError(e));try{this.handler.handleDeserializationError(i.utils.getStringifiedError(e))}catch(e){a().ULS.traceTag(596452184,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to handle deserialization error. "+i.utils.getStringifiedError(e))}return}if(t)try{this.handler.handleMessage(t).catch(function(e){a().ULS.traceTag(595985880,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+i.utils.getStringifiedError(e))})}catch(e){a().ULS.traceTag(596452186,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+i.utils.getStringifiedError(e))}else a().ULS.traceTag(596452185,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: the incoming message is empty")}},e}();var Fe=function(){function e(e,t,r){if(void 0===r&&(r=!1),this.serializer=e,this.delayedQueueEnabled=r,!e)throw new S(m,"serializer");if(!t)throw new S(m,"windowRPC");this.disposableImplementationExtension=ve("WindowRPCSenderInternal"),this.remoteWindow=t.remoteWindow}return e.prototype.postMessage=function(e){if(!e)throw new S(m,"outgoingMessage");if(!this.remoteWindow.window)throw new C("Configure the remote window");if(!this.remoteWindow.window.postMessage)throw new C("The remote window does not support postMessage");var t=this.serializer.serialize(e);E.postMessage(this.remoteWindow.window,t,this.remoteWindow.windowOrigin)},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()},e}(),Ne="OfficeOnlineCCP_Metadata_",Je="OfficeOnlineCCP_Data_",He="_LocalStorageChangedFlag";function je(e){return Ne+e}var ze;!function(e){e[e.Started=1]="Started",e[e.SynchronousPhaseCompleted=2]="SynchronousPhaseCompleted",e[e.Completed=3]="Completed"}(ze||(ze={}));var Ve=function(){function e(e){this.localStorageKey=e;try{if(!localStorage)throw new Error("LocalStorageClipboardStorage.ctor: localStorage == null")}catch(e){throw new y(u.LocalStorageInitilizationInaccessible,"LocalStorageClipboardStorage.ctor: filed access to localStorage",e)}if(!e)throw new y(u.LocalStorageInitilizationNoKey,"LocalStorageClipboardStorage.ctor: localStorageKey must be defined");this.clipboardStorageType=_.LocalStorage,this.disposableImplementationExtension=ve("LocalStorageClipboardStorage")}return e.prototype.get=function(e){this.disposableImplementationExtension.throwIfDisposed("get"),a().ULS.traceTag(595716238,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.get: commandParameters='"+(e?JSON.stringify(e):m)+"'");var t=localStorage.getItem(this.localStorageKey);if(!t)return Promise.resolve(M());try{var r=JSON.parse(t);if(!r||0===x(r))return Promise.resolve(M());var o=D(r);return Promise.resolve(o)}catch(e){return Promise.resolve(M())}},e.prototype.set=function(e,t){if(this.disposableImplementationExtension.throwIfDisposed("set"),a().ULS.traceTag(595716239,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.set: item count="+W(e)+"'; commandParameters='"+(t?JSON.stringify(t):m)+"'"),0===W(e))localStorage.removeItem(this.localStorageKey);else{localStorage.setItem(this.localStorageKey,JSON.stringify(e.getData()));var r=""+(this.localStorageKey+He),o=ge();a().ULS.traceTag(595715530,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.set: set local storage value. eventFalgKey = "+r+". eventFlagValue = "+o),localStorage.setItem(r,o)}return Promise.resolve()},e.prototype.getSupportedDataFormats=function(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[T,"text/html","data/shadow-workbook"]},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()},e}();function ke(e){return a().ULS.traceTag(595716236,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Attempting to create clipboard strategy type '"+d.LocalStorage+"' with localStorageKey: '"+e+"'"),(new Be).initialize(function(e){try{a().ULS.traceTag(595716237,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Attempting to create clipboard storage type '"+_.LocalStorage+"'");var t=new Ve(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}}(e))}var Be=function(e){function t(t){return e.call(this,d.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},t)||this}return c(t,e),t}(be),Ke=function(){function e(e,t,r){this.localStorageKeyToWatch=e,this.clipboardStrategy=t,this.listener=r,this.maxTimeToWaitInMilliseconds=2e3,this.lastLocalStorageValue=null,window.addEventListener("storage",this.onStorageChanged.bind(this))}return e.prototype.onStorageChanged=function(e){var t=this;a().ULS.shipAssertTag(595716249,i.LogCategory.msoulscat_ES_EWAJS,null!=e,"e should not be null"),a().ULS.traceTag(595716288,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.onStorageChanged:got storage change event. e.key = "+e.key+". localStorageKeyToWatch = "+this.localStorageKeyToWatch+". lastLocalStorageValue = "+this.lastLocalStorageValue),e.key===this.localStorageKeyToWatch&&(this.raiseMetadataChangedEvent(),a().ULS.traceTag(595716289,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.onStorageChanged: raised metadata change event. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged()||this.waitForLocalStorageValueToChange(this.maxTimeToWaitInMilliseconds).then(function(){t.raiseMetadataChangedEvent()},function(){a().ULS.traceTag(595716295,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"LocalStorageKeyChangeTracker.onStorageChanged: got rejected promise.")}))},e.prototype.raiseMetadataChangedEvent=function(){var e=this;return a().ULS.traceTag(595715525,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: starting raiseMetadataChangedEvent. lastLocalStorageValue = "+this.lastLocalStorageValue),this.clipboardStrategy.get({userHash:0}).then(function(t){e.listener(t),a().ULS.traceTag(595716232,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: sent message. lastLocalStorageValue = "+e.lastLocalStorageValue)},function(e){a().ULS.traceTag(595716233,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: failed to get metadata from clipboardStorage")})},e.prototype.isLocalStorageValueChanged=function(){var e=localStorage.getItem(this.localStorageKeyToWatch),t=this.lastLocalStorageValue!==e;return a().ULS.traceTag(595715526,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.isLocalStorageValueChanged: lastLocalStorageValue = "+this.lastLocalStorageValue+". currentLocalStorageValue = "+e),this.lastLocalStorageValue=e,t},e.prototype.waitForLocalStorageValueToChange=function(e){var t=this;if(a().ULS.traceTag(595715527,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: start waitForLocalStorageValueToChange. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged())return a().ULS.traceTag(595715528,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving because value was changed. lastLocalStorageValue = "+this.lastLocalStorageValue),Promise.resolve();var r=Ee(),o=new Date,n=setInterval(function(){var s=(new Date).getTime()-o.getTime();a().ULS.traceTag(595715529,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: call by setInterval. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),t.isLocalStorageValueChanged()?(clearInterval(n),a().ULS.traceTag(595716234,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),r.resolve()):s>e&&(clearInterval(n),a().ULS.traceTag(595716235,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: rejecting. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),r.reject())},200);return r.promise},e}(),Ge="\t",qe="\n",Qe="\r",Xe=(new RegExp("("+qe+Qe+")|("+Qe+qe+")|("+Qe+")","g"),new RegExp("("+Ge+")","g"),new RegExp("<","g"),new RegExp(">","g"),"\x3c!--StartFragment--\x3e"),$e="\x3c!--EndFragment--\x3e";Xe.length,$e.length;var Ye,Ze,et=r(1),tt=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();!function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(Ye||(Ye={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard"}(Ze||(Ze={}));var rt;(function(){function e(){}e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,r,o){return"tag_"+e.tagIntToString(t)+" ["+Ze[r]+"] "+o},e.prototype.sendTraceTag=function(t,r,o,n){var i=console.log;switch(o){case Ye.Error:i=console.error;break;case Ye.Warning:i=console.warn;break;case Ye.Info:i=console.info;break;case Ye.Verbose:i=console.debug;break;case Ye.Spam:default:i=console.log}try{i(e.getLogMessage(t,r,n))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,r,o,n){console.assert(o,e.getLogMessage(t,r,n))},e.prototype.debugAssertTag=function(e,t,r,o){this.shipAssertTag(e,t,r,o)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function e(){this.externalLogger=new tt}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,r,o){this.externalLogger.sendTraceTag(e,t,r,o)},e.prototype.debugAssertTag=function(e,t,r,o){this.externalLogger.debugAssertTag(e,t,r,o)},e.prototype.shipAssertTag=function(e,t,r,o){this.externalLogger.shipAssertTag(e,t,r,o)},e}());function ot(e,t,r,o){var n=e.map(function(e){return function(e,t){var r={};r.G=e.tag,r.T=e.timestamp-t,r.M=e.message,r.C=e.category;var o=e.type*nt+e.level;return r.D=o,r}(e,o)}),i=function(e,t,r,o){var n={};return n.T=e,n.L=t,n.S=r,n.I=o,n.V=1,n}(o,n,t,r);return JSON.stringify(i)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(rt||(rt={}));var nt=1e3;var it=function(){function e(t,r){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout(function(){return o.triggerUpload(!0,!0)},0)},this.triggerUpload=function(t,r){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,function(e,t,r){if(""!==t){var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,r),o.send(e))}}(ot(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,r),o.logCache=[],o.timestampBase=Date.now());t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=r+"?usid="+t,window.setTimeout(function(){return o.triggerUpload(!0,!0)},0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===Ye.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]",e}();var at=Ye.Info;function st(e,t,r,o,n){if(!(o>at)){var i={timestamp:Date.now(),category:r,tag:t,level:o,type:rt.Trace,message:n};e.handleTrace(i)}}!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}c(t,e)}(tt);function lt(e,t){var r=function(e,t){var r=new it(e,t);return{sendTraceTag:function(e,t,o,n){return st(r,e,t,o,n)},shipAssertTag:function(e,t,o,n){o&&st(r,e,t,Ye.Error,n)},debugAssertTag:function(){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:r.flush,flushOnClose:r.flushOnClose}}(t,e);return{assertTag:function(e,t,o,n){return r.shipAssertTag(e,t,!o,n)},shipAssertTag:function(e,t,o,n){return r.shipAssertTag(e,t,!o,n)},debugTraceTag:r.sendTraceTag,traceTag:r.sendTraceTag}}var ct=function(e){function t(t){var r=e.call(this)||this;return r.clipboardStrategy=t,r.nameForTelemetry="ClipboardStrategyMessageHandler_StrategyType_"+t.clipboardStrategyType,r.addMessageHandler("get",{handleMessage:r.get.bind(r)}),r.addMessageHandler("set",{handleMessage:r.set.bind(r)}),r}return c(t,e),t.prototype.get=function(e,t){var r={userHash:e.userHash};return this.clipboardStrategy.get(r).then(function(e){return t.clipboardItemsData=e.getData(),Promise.resolve(t)},function(e){return dt(t,e)})},t.prototype.set=function(e,t){var r={userHash:e.userHash},o=void 0;return e.clipboardItemsData&&(o=e.clipboardItemsData),this.clipboardStrategy.set(D(o),r).then(function(){return Promise.resolve(t)},function(e){return dt(t,e)})},t}(function(){function e(){this._handlers={}}return e.prototype.handleMessage=function(e,t){return e&&e.operationCode in this._handlers?this._handlers[e.operationCode].handleMessage(e,t):dt(t,new y(u.UnsupportedOperationCode,"Operation code '"+(e?e.operationCode:"incomingMessage is null")+"' is unsupported"))},e.prototype.addMessageHandler=function(e,t){e?e in this._handlers?a().ULS.shipAssertTag(595944464,i.LogCategory.msoulscat_ES_EWAJS,!1,"BaseMessageHandler.addMessageHandler: handle for operation: "+e+" already exist"):this._handlers[e]=t:a().ULS.shipAssertTag(595944463,i.LogCategory.msoulscat_ES_EWAJS,!1,"BaseMessageHandler.addMessageHandler: expected operationCode to be defined")},e}());function dt(e,t){return ut(e,t),Promise.resolve(e)}function ut(e,t){e.failed=!0,e.error=i.utils.getStringifiedError(t)}var gt=function(e){function t(t,r,o,n){var i=e.call(this,r,t,o,"WindowRPCServerInternal")||this;if(i.windowRPCServerState=n,!n)throw new y(u.CreateWindowRPCServer,"windowRPCServerState is undefined.");return i.receiver=function(e,t,r){return new Ue(e,t,r)}(t,i,i),i.sender=function(e,t){return new Fe(e,t)}(r,i),i}return c(t,e),t.prototype.handleMessage=function(e){var t=this;if(a().ULS.traceTag(596452360,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"RPC Server - handleMessage: incomingMessage.id='"+(e&&e.id)+"'; incomingMessage.operationCode='"+(e&&e.operationCode)+"'; incomingMessage.clipboardItems.length="+x(e&&e.clipboardItemsData)),this.windowRPCServerState.isInitializationPending()&&e&&"init"===e.operationCode)return a().ULS.traceTag(596129562,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"The clipboard strategy is not initialized yet. Once it's done, it'll send an 'initresult' message."),Promise.resolve();var r=e&&e.id?e.id:"unknownmessageid",o=!e||!e.operationCode||!he(e.operationCode),n={id:r,failed:o,error:void 0,operationCode:o?"unknownresult":e.operationCode+"result"};return this.routeOperation(e,n).then(function(e){return t.postMessage(e)}).catch(function(e){return a().ULS.traceTag(596452182,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleMessage: unable to send result message. Sending a failure message. "+i.utils.getStringifiedError(e)),n.clipboardItemsData=void 0,ut(n,e),t.postMessage(n)}).catch(function(e){return a().ULS.traceTag(596452183,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleMessage: unable to send failure result message. "+i.utils.getStringifiedError(e)),Promise.reject(e)})},t.prototype.routeOperation=function(e,t){if(this.windowRPCServerState.isInitializationPending())return dt(t,new y(u.SelectClipboardStrategy,"A clipboard strategy had not been selected and initialized yet"));if(!this.windowRPCServerState.isInitializedSuccessfully())return dt(t,this.windowRPCServerState.getClipboardInitError());if("init"===e.operationCode)return Promise.resolve(t);var r=this.windowRPCServerState.getMessageHandler(e.destination);return r?r.handleMessage(e,t):dt(t,new y(u.SelectClipboardStrategy,"messageHandler does not exist"))},t.prototype.handleDeserializationError=function(e){return this.postMessage({id:"unknownmessageid",failed:!0,error:e,operationCode:"unknownresult"}).catch(function(e){a().ULS.traceTag(596451867,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleDeserializationError: unable to send failure result message. "+i.utils.getStringifiedError(e))})},t.prototype.postMessage=function(t){try{return e.prototype.postMessage.call(this,t),Promise.resolve()}catch(e){return Promise.reject(new C("Unable to post message for operation '"+(t&&t.operationCode?t.operationCode:m)+"'",e))}},t}(We),pt=function(e){function t(t,r,o){var n=e.call(this,o,"getMetadata_longPollingresult")||this;return n.localStorageKeyChangeTracker=new Ke(r,t,n.raiseMetadataChangedEvent.bind(n)),n}return c(t,e),t.prototype.raiseMetadataChangedEvent=function(e){this.sendMessage(e.getData())},t}(function(){function e(e,t){this.windowRPCServer=e,this.operationCode=t}return e.prototype.sendMessage=function(e){if(this.windowRPCServer){var t=we(ge(),this.operationCode,!1,void 0,e);this.windowRPCServer.postMessage(t)}},e}());function ft(e,t){if(!t)return Promise.resolve(!1);var r=function(e,t){try{var r=window.parent,o=e;if(!o)throw new S("remoteWindowOrigin is undefined","remoteWindowOrigin");return new gt(Pe(Se),Ae(Ce),{window:r,windowOrigin:o},t)}catch(e){return void a().ULS.shipAssertTag(595981475,i.LogCategory.msoulscat_ES_EWAJS,!1,"createWindowRPCServer failed with exception: "+i.utils.getStringifiedError(e))}}(e,mt);if(!r)return a().ULS.traceTag(595947554,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"initModuleState: Failed to create windowRPCServer"),Promise.resolve(!1);var o=Ee(Me);return(ht={initMessageIdUniqueRunningSuffix:1,initializationDeferredPromise:o,windowRPCServer:r}).initializationDeferredPromise.promise.then(function(){return function(){var e=wt();if(a().ULS.shipAssertTag(595947555,i.LogCategory.msoulscat_ES_EWAJS,!!e,"sendClipboardInitializationSuccessResult: windowRPCServer must be defined"),!e)return Promise.reject(new C("sendClipboardInitializationSuccessResult cannot post a message since WindowRPCServer could not be created"));var t=we(Ct(),"initresult",!1);return e.postMessage(t)}()},function(e){return function(e){var t=wt();if(a().ULS.shipAssertTag(595947584,i.LogCategory.msoulscat_ES_EWAJS,!!t,"sendClipboardInitializationFailureResult: windowRPCServer must be defined"),!t)return Promise.reject(new C("sendClipboardInitializationFailureResult cannot post a message since WindowRPCServer could not be created"));var r=we(Ct(),"initresult",!0,i.utils.getStringifiedError(e));return t.postMessage(r)}(e)}).catch(function(){}),t.then(function(e){return ht&&(ht.metadataDataChangedMessageSender=new pt(e.metadataClipboardStrategy,e.localStorageMetadataKeyToWatch,r)),function(e){var t=Object.keys(e).map(function(t){return"Name: "+t+", handlerName: "+(e[t]&&e[t].nameForTelemetry)}).join(", ");if(a().ULS.traceTag(595947585,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"markInitializationSuccess: Created and initialized ClipboardStrategies '"+t+"'"),a().ULS.shipAssertTag(595947586,i.LogCategory.msoulscat_ES_EWAJS,!!ht,"markInitializationSuccess: windowRPCServerInternalState must be defined"),!ht)return;ht.clipboardOperationMessageHandlerMap=e,ht.clipboardInitError=void 0,ht.clipboardInitTimestamp=Date.now(),ht.initializationDeferredPromise&&ht.initializationDeferredPromise.resolve()}(e.messageHandlers),Promise.resolve(!0)},function(e){return function(e){if(a().ULS.traceTag(595947587,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"markInitializationFailure: Failed to initialize ClipboardStrategies"),a().ULS.shipAssertTag(595947588,i.LogCategory.msoulscat_ES_EWAJS,!!ht,"markInitializationFailure: windowRPCServerInternalState must be defined"),!ht)return;ht.clipboardOperationMessageHandlerMap=void 0,ht.clipboardInitError=e,ht.clipboardInitTimestamp=Date.now(),ht.initializationDeferredPromise&&ht.initializationDeferredPromise.reject(ht.clipboardInitError)}(e),Promise.resolve(!1)})}var mt={getMessageHandler:function(e){if(!ht)return;if(!e)return void a().ULS.shipAssertTag(595945235,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: expected destination to be defined");if(!ht.clipboardOperationMessageHandlerMap)return void a().ULS.shipAssertTag(595945236,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: clipboardOperationMessageHandlerMap is not initialized");if(!(e in ht.clipboardOperationMessageHandlerMap))return void a().ULS.shipAssertTag(595945237,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: "+e+" is not part of ClipboardStrategyMap");return ht.clipboardOperationMessageHandlerMap[e]},isInitializationPending:St,isInitializedSuccessfully:function(){if(ht)return!St()&&!!ht.clipboardOperationMessageHandlerMap;return!1},getClipboardInitError:function(){if(ht)return ht.clipboardInitError;return}},ht=void 0;function St(){return!ht||!ht.initializationDeferredPromise||!ht.initializationDeferredPromise.fulfilled()}function wt(){if(ht)return ht.windowRPCServer}function Ct(){if(!ht)return m;var e=ht.initMessageIdUniqueRunningSuffix;return ht.initMessageIdUniqueRunningSuffix+=1,""+Me+e}function vt(){s(new et.ConsoleLogger),o.initializeSharedClipboardSettingsFromWindow();var e="";try{e=i.utils.getQueryParameterByName(window.location.href,xe)||"";var t=i.utils.getQueryParameterByName(window.location.href,U)||"";if(!e)throw new S("remoteWindowOrigin is undefined","remoteWindowOrigin");e=ae(e);var r=o.getSharedClipboardSettings().remoteLoggerPath;if(r&&t)s(lt(""+e+r,t))}catch(e){}var n=o.getSharedClipboardSettings().sharedClipboardSchemaVersion;return ft(e,ke(function(e){return Je+e}(n)).then(function(e){var t=je(n),r=function(e){return je(e)+He}(n);return ke(t).then(function(t){var o={};return o[me.localStorageData]=new ct(e),o[me.localStorageMetadata]=new ct(t),{messageHandlers:o,localStorageMetadataKeyToWatch:r,dataClipboardStrategy:e,metadataClipboardStrategy:t}})}))}r.d(t,"a",function(){return vt})},function(e,t,r){"use strict";r.r(t);var o=r(0);for(var n in o)"default"!==n&&function(e){r.d(t,e,function(){return o[e]})}(n);var i=r(3);r.d(t,"initialize",function(){return i.a})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=r(2);function i(e,t,r){return e?!(t&&!e.objectStoreNames.contains(t))||(r({name:"ValidationError",message:"The database doesn't contain store name: "+t}),!1):(r({name:"ValidationError",message:"The database should be initialized"}),!1)}var a=void 0;function s(e){void 0!==a&&a(e)}function l(e,t,r,o){return new Promise(function(n,a){if(i(e,t,a)){var s,l=e.transaction([t],r);l.oncomplete=function(){return n()},l.onerror=function(){return a(s||l.error)},l.onabort=function(){return a(s||l.error)};var c=l.objectStore(t),d=o(c);d.onerror=function(){s=d.error}}})}t.registerTraceSubscriber=function(e){a=e},t.clearTraceSubscriber=function(){a=void 0},t.setTestDbFactory=function(e){o=e},t.getDbFactory=function(){if(o)return o;try{if(window&&"indexedDB"in window&&void 0!==window.indexedDB)return window.indexedDB}catch(r){var e=n.getStringifiedError(r);e&&e!==n.defaultToJSONResultWhenStringifyFails||!r||!r.message||(e=r.message);var t=n.getPerfWatchMarkName(e);s("indexedDB_access_error"+(t&&t.length>0?"_":"")+t)}},t.getStoreReadinessPromise=function(e){return new Promise(function(t,r){e.transaction.oncomplete=function(){return t()},e.transaction.onerror=function(){return r(e.transaction.error)}})},t.initDb=function(e,t,r,o){return new Promise(function(n,i){s("idb_open");var a,l,c,d,u=r||0===r?e.open(t,r):e.open(t),g=(a=!1,l=!1,c=function(e){s("idb_open_"+e)},d=function(){return l?(c("already_resolved"),!1):!a||(c("already_rejected"),!1)},{rejectOnce:function(e){c("should_reject"),d()&&(c("rejecting"),a=!0,i(e))},resolveOnce:function(e){c("should_resolve"),d()&&(c("resolving"),l=!0,n(e))}});u.onupgradeneeded=function(e){s("idb_open_onupgradeneeded_start");var r=e.target.result;if(e.oldVersion>0&&function(e){s("idb_open_onupgradeneeded_deleteAllObjectStores");for(var t=[],r=e.objectStoreNames.length-1;r>=0;r-=1){var o=e.objectStoreNames.item(r);(o||""===o)&&t.push(o)}t.forEach(function(t){s("idb_open_onupgradeneeded_delete_store_"+t),e.deleteObjectStore(t)})}(r),o){s("idb_open_onupgradeneeded_create_stores");var n=o(r);n&&n.length>0&&Promise.all(n).then(function(){s("idb_open_onupgradeneeded_stores_ready"),g.resolveOnce({db:r,dbName:t})},function(e){s("idb_open_onupgradeneeded_stores_ready_error"),g.rejectOnce(e)})}s("idb_open_onupgradeneeded_end")},u.onsuccess=function(e){s("idb_open_onsuccess"),g.resolveOnce({db:e.target.result,dbName:t})},u.onerror=function(){s("idb_open_onerror"),g.rejectOnce(u.error)},u.onblocked=function(e){s("idb_open_onblocked"),g.rejectOnce(e)}})},t.deleteDb=function(e,t){return new Promise(function(r,o){var n=e.deleteDatabase(t);n.onsuccess=function(){return r()},n.onblocked=function(){return r()},n.onerror=function(){return o(n.error)}})},t.doTransactionAction=l,t.put=function(e,t,r,o){return l(e,t,"readwrite",function(e){return r?e.put(o,r):e.put(o)})},t.get=function(e,t,r){return new Promise(function(o,n){if(i(e,void 0,n)){var a;e.objectStoreNames.contains(t)||o(void 0);var s=void 0,l=e.transaction([t],"readonly");l.oncomplete=function(){return o(s)},l.onerror=function(){return n(a||l.error)},l.onabort=function(){return n(a||l.error)};var c=l.objectStore(t).get(r);c.onsuccess=function(e){s=e.target.result},c.onerror=function(){a=c.error}}})},t.getAllItems=function(e,t){return new Promise(function(r,o){if(i(e,t,o)){var n,a=[],s=e.transaction([t],"readonly");s.oncomplete=function(){return r(a)},s.onerror=function(){return o(n||s.error)},s.onabort=function(){return o(n||s.error)};var l=s.objectStore(t).openCursor();l.onsuccess=function(e){var t=e.target.result;t&&(a.push(t.value),t.continue())},l.onerror=function(){n=l.error}}})},t.getAllKeys=function(e,t){return new Promise(function(r,o){if(i(e,t,o)){var n,a=[],s=e.transaction([t],"readonly");s.oncomplete=function(){return r(a)},s.onerror=function(){return o(n||s.error)},s.onabort=function(){return o(n||s.error)};var l=s.objectStore(t).openCursor();l.onsuccess=function(e){var t=e.target.result;t&&(a.push(t.key),t.continue())},l.onerror=function(){n=l.error}}})},t.remove=function(e,t,r){return l(e,t,"readwrite",function(e){return e.delete(r)})},t.removeAll=function(e,t){return l(e,t,"readwrite",function(e){return e.clear()})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},n="promises";t.promises=function(){return void 0===o[n]&&(o[n]="undefined"!=typeof Promise&&"function"==typeof Promise.resolve&&Promise.resolve(0)&&"function"==typeof Promise.resolve(0).then),o[n]}},function(e,t,r){"use strict";function o(){return window.performance&&window.performance.now?window.performance.now():Date.now()}function n(e,t,r){e[t]=o()-r}Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(e){var t=o(),r=e,i=t,a={},s=function(e,t,o){return function(e,t,r,o,i,a){n(e,"end",r);var s={sessionName:t,result:o?"success":"failure",message:a,marks:e},l=JSON.stringify(s);i(l)}(a,r,i,e,t,o)};return a.start=0,{mark:function(e){return function(e){return n(a,e,i)}(e)},end:function(e){return s(!0,e)},success:function(e,t){return s(!0,e,t)},failure:function(e,t){return s(!1,e,t)}}},t.mark=function(e,t){void 0!==e&&e.mark(t)},t.end=function(e,t){void 0!==e&&e.end(t)},t.success=function(e,t,r){void 0!==e&&e.success(t,r)},t.failure=function(e,t,r){void 0!==e&&e.failure(t,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={isChangeGateEnabled:function(e){return!1}};t.ewaUtils=function(){return o},t.initEwaUtils=function(e){if(!e)throw new Error("the 'ewaUtils' argument is missing");o=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return Date.now()};t.initStopwatchFactory=function(e,t){return void 0===t&&(t=1),"undefined"!=typeof self&&self.performance&&self.performance.now&&(o=function(){return self.performance.now()}),function(r){var n=o(),i=r;return{reset:function(e){null!=e&&(i=e),n=o()},stop:function(){var r=o()-n,a=JSON.stringify({Target:i,Duration:r.toFixed(t)});e(a)}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewGuid=function(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},r=window.crypto||window.msCrypto;if(r){t.crypto=!0;try{return r.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+JSON.stringify(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+JSON.stringify(e))}for(var i=0;i<e.length;i+=1){try{if(o){t.perfNow=!0;var a=Math.floor(100*n.now())%10;(a<0||a>9)&&(a=0);for(var s=0;s<a;s+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+JSON.stringify(e))}e[i]=Math.floor(16*Math.random())}return t}(e),r=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=15&e[r];return r+=1,("x"===t?o:3&o|8).toString(16)}),t]}}]);
//# sourceMappingURL=sharedClipboard.min.js.map